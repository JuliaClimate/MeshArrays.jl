<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Main Features · MeshArrays</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">MeshArrays</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../start/">Get Started</a></li><li><a class="tocitem" href="../tutorials/">Notebook Tutorials</a></li><li><a class="tocitem" href="../videos/">Video Examples</a></li><li class="is-active"><a class="tocitem" href>Main Features</a><ul class="internal"><li><a class="tocitem" href="#Summary"><span>Summary</span></a></li><li><a class="tocitem" href="#Data-Structures"><span>Data Structures</span></a></li><li><a class="tocitem" href="#Embedded-Metadata"><span>Embedded Metadata</span></a></li><li><a class="tocitem" href="#Visualization,-Particles,-Transports"><span>Visualization, Particles, Transports</span></a></li></ul></li><li><a class="tocitem" href="../API/">API documentation</a></li><li><a class="tocitem" href="../detail/">Miscellaneous</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Main Features</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Main Features</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaClimate/MeshArrays.jl/blob/master/docs/src/main.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Main-Features"><a class="docs-heading-anchor" href="#Main-Features">Main Features</a><a id="Main-Features-1"></a><a class="docs-heading-anchor-permalink" href="#Main-Features" title="Permalink"></a></h1><ul><li><code>MeshArray</code>, <code>gcmgrid</code>, <code>varmeta</code></li><li>full Earth grid examples (C-grids)</li><li>vector fields, transports, budgets</li><li>interpolation, distances, collocation</li></ul><h2 id="Summary"><a class="docs-heading-anchor" href="#Summary">Summary</a><a id="Summary-1"></a><a class="docs-heading-anchor-permalink" href="#Summary" title="Permalink"></a></h2><p>The <code>MeshArray</code> type is a sub-type of <code>AbstractArray</code> with an <code>outer array</code> where each element is itself a 2D <code>inner array</code>. By default, outer and inner arrays are of all of the standard <code>Array</code> type. However, this setup potentially allows different choices for the outer and inner arrays – for example <code>DistributedArrays</code> and <code>AxisArrays</code>, respectively, could be an option. <code>MeshArrays.jl</code> thus provides a simple but general solution to analyze or e.g. simulate climate system variables. By default the <code>MeshArray</code> type is an alias to the <a href="../API/#MeshArrays.gcmarray"><code>MeshArrays.gcmarray</code></a> type.</p><p>The internals of a <code>MeshArray</code> are regulated by its <code>gcmgrid</code> – a struct containing just a few index ranges, array size specifications, and inter-connection rules. A second  lightweight struct, <code>varmeta</code>, contains the <code>MeshArray</code> variable name, its unit, time, and position in grid space. A general approach like this is useful because climate models often involve advanced domain decompositions (see, e.g., <a href="../start/#Grids">Grids</a>), and many variables, which can put a burden on users. </p><p>Encoding the grid specification inside the <code>MeshArray</code> data type allows user to manipulate <code>MeshArray</code>s just like they would manipulate <code>Array</code>s without having to invoke model grid details explicitely. In addition, the provided <code>exchange</code> methods readily transfer data between connected subdomains to extend them at the sides. This makes it easy to compute e.g. partial derivatives and related operators like gradients, curl, or divergences over subdomain edges as often needed for precise computation of transports, budgets, etc using climate model output (see, e.g., <a href="../tutorials/#Tutorials">Tutorials</a>).</p><p><img src="https://user-images.githubusercontent.com/20276764/137231635-fdd12de0-29fe-45d4-9045-60621668e353.png" alt="smooth_cs32"/></p><h2 id="Data-Structures"><a class="docs-heading-anchor" href="#Data-Structures">Data Structures</a><a id="Data-Structures-1"></a><a class="docs-heading-anchor-permalink" href="#Data-Structures" title="Permalink"></a></h2><p>The elements of a <code>MeshArray</code> /  are arrays. These elementary arrays typically represent subdomains inter-connected at their edges. The organization and connections between subdomains is determined by a user-specified <a href="../API/#MeshArrays.gcmgrid"><code>gcmgrid</code></a> which is embeded inside each <a href="../API/#MeshArrays.gcmarray"><code>MeshArrays.gcmarray</code></a> instance. </p><p><code>Interpolate</code> can be used to interpolate a <code>MeshArray</code> to any location (i.e. arbitrary longitude, latitude pair). <code>Exchange</code> methods transfer data between neighboring arrays to extend computational subdomains – this is often needed in analyses of climate or ocean model output. </p><p>The current default for <code>MeshArray</code> is the <code>gcmarray</code> type, with various examples provided in the <a href="../tutorials/#Tutorials">Tutorials</a>.</p><p>One of the examples is based on a grid known as <code>LatLonCap</code> where each global map is associated with 5 subdomains of different sizes. The grid has <code>50</code> depth levels. Such a <code>MeshArray</code> has a size of <code>(5, 50)</code> (see <a href="../tutorials/#Tutorials">Tutorials</a>).</p><p>The underlying, <code>MeshArray</code>, data structure is:</p><pre><code class="nohighlight hljs">struct gcmarray{T, N} &lt;: AbstractMeshArray{T, N}
   grid::gcmgrid
   meta::varmeta
   f::Array{Array{T,2},N}
   fSize::Array{NTuple{2, Int}}
   fIndex::Array{Int,1}
   version::String
end</code></pre><p>A <code>MeshArray</code> generally behaves just like an <code>Array</code> and the <em>broadcasting</em> of operations has notably been customized so that it reaches elements of each elementary array (i.e. within <code>f[i]</code> for each index of <code>f</code>).</p><p>In addition, <code>Mesharray</code> specific functions like <code>exchange</code> can alter the internal structure of a <code>MeshArray</code> by adding rows and columns at the periphery of subdomains. </p><h2 id="Embedded-Metadata"><a class="docs-heading-anchor" href="#Embedded-Metadata">Embedded Metadata</a><a id="Embedded-Metadata-1"></a><a class="docs-heading-anchor-permalink" href="#Embedded-Metadata" title="Permalink"></a></h2><p>A <a href="../API/#MeshArrays.gcmarray"><code>MeshArrays.gcmarray</code></a> includes a <a href="../API/#MeshArrays.gcmgrid"><code>gcmgrid</code></a> specification which can be constructed as outlined below.</p><pre><code class="nohighlight hljs">struct gcmgrid
  path::String
  class::String
  nFaces::Int
  fSize::Array{NTuple{2, Int},1}
  ioSize::Union{NTuple{2, Int},Array{Int64,2}}
  ioPrec::Type
  read::Function
  write::Function
end</code></pre><p>The grid <code>class</code> can be set to <em>LatLonCap</em>, <em>CubeSphere</em>, <em>PeriodicChannel</em>, or <em>PeriodicDomain</em>. For example, A <em>PeriodicChannel</em> (periodic in the x direction) of size 360 by 160, can be defined as follows.</p><pre><code class="nohighlight hljs">pth=MeshArrays.GRID_LL360
class=&quot;PeriodicChannel&quot;
ioSize=(360, 160)
ioPrec=Float32

γ=gcmgrid(pth, class, 1, [ioSize], ioSize, ioPrec, read, write)</code></pre><p>Importantly, a <code>gcmgrid</code> does <strong>not</strong> contain any actual grid data – hence its memory footprint is minimal. Grid variables are instead read to memory only when needed e.g. as shown below. To make this easy, each <code>gcmgrid</code> includes a pair of <code>read</code> / <code>write</code> methods to allow for basic <code>I/O</code> at any time. These methods are typically specified by the user although defaults are provided. </p><pre><code class="nohighlight hljs">using MeshArrays, Unitful
γ=GridSpec(&quot;LatLonCap&quot;,MeshArrays.GRID_LLC90)
m=MeshArrays.varmeta(u&quot;m&quot;,fill(0.5,2),missing,&quot;Depth&quot;,&quot;Depth&quot;)
D=γ.read(γ.path*&quot;Depth.data&quot;,MeshArray(γ,Float64;meta=m))</code></pre><p>The above commands define a <code>MeshArray</code> called <code>D</code> which is the one displayed at the top of this section. A definition of the <code>varmeta</code> structure is reported below. The <code>position</code> of a <code>D</code> point within its grid cell is given as <code>x ∈ [0. 1.]</code> in each direction.</p><pre><code class="nohighlight hljs">struct varmeta
  unit::Union{Unitful.Units,Number,Missing}
  position::Array{Float64,1}
  time::Union{DateTime,Missing,Array{DateTime,1}}
  name::String
  long_name::String
end</code></pre><p><img src="https://raw.githubusercontent.com/juliaclimate/MeshArrays.jl/master/docs/images/interp_depth.png" alt="OceanDepthMap"/></p><h2 id="Visualization,-Particles,-Transports"><a class="docs-heading-anchor" href="#Visualization,-Particles,-Transports">Visualization, Particles, Transports</a><a id="Visualization,-Particles,-Transports-1"></a><a class="docs-heading-anchor-permalink" href="#Visualization,-Particles,-Transports" title="Permalink"></a></h2><p>A simple way to plot a <code>MeshArray</code> consists in plotting each elementary array separately. This method is illustrated in the <a href="../tutorials/#Tutorials">Tutorials</a> along with others that produce global maps. The <a href="https://juliaclimate.github.io/GlobalOceanNotebooks/">JuliaClimate Notebooks</a> provide additional examples and a series of use case examples related to Earth System transports. This include using gridded flow fields to integrate transports, streamfunctions, budgets.</p><p>Lagrangian trajectories are readily computed with <a href="https://github.com/JuliaClimate/IndividualDisplacements.jl">IndividualDisplacements.jl</a> when velocity fields are provided as <code>MeshArray</code>s. Another set of examples shows that <code>MeshArrays.jl</code> can ingest any standard grid from the <a href="https://mitgcm.readthedocs.io/en/latest/?badge=latest">MIT general circulation model</a> with I/O routines provided by <a href="https://github.com/gaelforget/MITgcmTools.jl">MITgcmTools.jl</a> as also demontrated in <a href="https://github.com/gaelforget/ClimateModels.jl">ClimateModels.jl</a> and the <a href="https://juliaclimate.github.io/GlobalOceanNotebooks/">JuliaClimate Notebooks</a>.</p><p><img src="https://github.com/JuliaClimate/Notebooks/raw/master/page/figures/MOC.png" alt="OceanMOC"/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../videos/">« Video Examples</a><a class="docs-footer-nextpage" href="../API/">API documentation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Sunday 29 January 2023 21:39">Sunday 29 January 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
